
<script src="~/Scripts/_CreateScript.js" defer></script>
<script src="~/Scripts/_delete.js" defer></script>
<script src="~/Scripts/_Detail.js" defer></script>

<div class="card card-body ">
    <p>
        <button class="anchorDetail btn btn-lg" data-url="/Subcategories/Create" data-bs-toggle="model" data-target="#myModal"><i class="fa-solid fa-plus"></i></button>
    </p>

    <table class="display compact" id="example0">
        <thead>
            <tr>
                <th>
                    SubCatagory
                </th>
                <th>
                    Catagory
                </th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>

            @foreach (var item in ViewBag.Subcatagory)
            {
                <tr>
                    <td>
                        @item.SubCatname
                    </td>
                    <td>
                        @item.Category.Catname
                    </td>
                    <td>
                        <button href="#" class="anchorDetail btn  btn-sm" data-url="/Subcategories/Edit" data-id="@item.SubCatID" data-bs-toggle="model" data-target="#myModal">
                            <i class="fa-solid fa-pen-to-square"></i>
                        </button>

                        <button class="anchorDetail btn  btn-sm" data-url="/Subcategories/Details" data-id="@item.SubCatID" data-bs-toggle="model" data-target="#myModal">

                            <i class="fa-solid fa-circle-info"></i>
                        </button>
                        @*<button id="Deletes" class="btn btn-danger btn-sm" data-url="/Subcategories/DeleteConfirmed/" data-id="@item.SubCatID">Delete</button>*@

                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

<style>
    /* Add custom styling for the reload button */
    #ProdetailreloadButton {
        background: transparent;
        border: none;
        color: green;
        cursor: pointer;
        font-size: 16px;
        padding: 5px 10px;
        transition: color 0.3s ease;
    }

        #ProdetailreloadButton:hover {
            color: darkgreen;
        }
</style>
<script>
    $(document).ready(function () {
        $('#example0').DataTable();

        $('.dataTables_filter').prepend('<button id="ProdetailreloadButton"><i class="fas fa-sync-alt"></i></button>');
        // Use event delegation to bind the click event handler to dynamically added button
        $(document).on('click', '#ProdetailreloadButton', function () {
            
            $.ajax({
                url: '/Subcategories/UpdateTable',
                method: 'GET',
                success: function (data) {
                    $('#example0 tbody').empty();
                    

                    for (var i = 0; i < data.data.length; i++) {
                        
                        var newRow = '<tr>' +
                            '<td>' + data.data[i].CategoryName + '</td>' +
                            '<td>' + data.data[i].SubCategoryName + '</td>' +
                            '<td>' +
                            '<button href="#" class="anchorDetail btn btn-sm" data-url="/Subcategories/Edit" data-id="' + data.data[i].Id + '" data-bs-toggle="modal" data-target="#myModal">' +
                            '<i class="fa-solid fa-pen-to-square"></i>' +
                            '</button>' +
                            '<button href="#" class="anchorDetail btn btn-sm" data-url="/Subcategories/Details" data-id="' + data.data[i].Id + '" data-bs-toggle="modal" data-target="#myModal">' +
                            '<i class="fa-solid fa-circle-info"></i>' +
                            '</button>' +
                            '</td>' +
                            '</tr>';
                        $('#example0 tbody').append(newRow);
                        
                    }
                    
                },
                error: function (xhr, status, error) {
                    console.log(error);
                }
            });
        });
    });
</script>

<script>

        $(function () {
            $("#Deletes").click(function () {

                var id = $(this).attr('data-id');
                var url = $(this).attr('data-url');

                Swal.fire({
                    icon: 'warning',
                    title: 'Are you sure you want to delete this record?',
                    showDenyButton: false,
                    showCancelButton: true,
                    confirmButtonText: 'Yes'
                }).then((result) => {
                    /* Read more about isConfirmed, isDenied below */
                    if (result.isConfirmed) {


                        // Ajax config
                        $.ajax({
                            type: "POST", //we are using GET method to get data from server side
                            url: url + id, // get the route value
                            contentType: "application/json; charset=utf-8",
                            dataType: "json", //set data
                            beforeSend: function () {//We add this before send to disable the button once we submit it so that we prevent the multiple click

                            },
                            success: function (response) {//once the request successfully process to the server side it will return result here
                                // Reload lists of employees
                                if (response.success) {

                                    Swal.fire('Success.', response, 'success')
                                    $('#ProdetailreloadButton').click();

                                } else {

                                    Swal.fire('Warning', response, 'Warning')
                                }
                            }
                        });


                    } else if (result.isDenied) {
                        Swal.fire('Changes are not saved', '', 'info')
                    }
                });

            });
        });
    </script>
